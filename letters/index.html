<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>GumiRing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta charset="UTF-8" />
    <title>A message to people if I'm not here</title>
    <script src="https://unpkg.com/openpgp@5.10.0/dist/openpgp.min.js"></script>
    <link rel="stylesheet" href="/styles.css" />
    <style>
        /* CRT style and typewriter effect for decrypted message */
        #output.crt-typewriter {
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            /* big text */
            color: #00ff00;
            /* bright green */
            text-shadow:
                0 0 5px #00ff00,
                0 0 10px #00ff00,
                0 0 20px #00ff00,
                0 0 30px #00ff00,
                0 0 40px #00ff00,
                0 0 55px #00ff00,
                0 0 75px #00ff00;
            white-space: pre-wrap;
            /* preserve line breaks */
            user-select: text;
            min-height: 4rem;
            /* prevent jumping */
        }
    </style>
</head>

<body>

    <div id="banner" class="crt" style="
    margin-left: auto;
    margin-right: auto;
    width: fit-content;">
        Letters
    </div>
    <div class="content crt">

        <h2 class="textshadow">üîê Decrypt Your Letter</h2>

        <label for="recipient" class="textshadow">Choose your name:</label>
        <select id="recipient" class="crt">
            <option value="">-- Select --</option>
            <option value="luna">Clementine</option>
            <option value="mateo">Melcon</option>
            <option value="alex">Space</option>
        </select>

        <br><br>

        <label for="passphrase" class="textshadow">Enter your shared secret:</label>
        <input type="password" id="passphrase" placeholder="Enter passphrase" class="textshadow" />

        <br><br>

        <button onclick="decrypt()" class="crt">üîì Unlock Letter</button>

        <hr>

        <div id="hint" class="crt subtext">[Nothing yet]</div>
        <div id="output" class="crt subtext"></div>

    </div>

    <script>
        const encryptedMessages = {
            luna: `-----BEGIN PGP MESSAGE-----

jA0ECQMI6a1Gu08Nu8/60ukB7w+lj1YKxESlXNnPhAG/K714o3xastsNHauaA0PO
z/a8L0IVDOz6BIoObcXYDeeTdvNhmnTtoqpn/q15ywAdy8KgICVxk9pLa8YsTkVf
7TsFbYKSVqqFqJHLHvz2LT3ZXUG3lAG4LKnrGjrfODJxRK78iGPhPtW6g/BKEOiy
Gma1Y+uiIy+TqhWt5yRzuq4TS65cRKnI2LJo1nXjRwXXBVuFhMgqfmVmRtWdZsdp
y1fp1UHsBuPdnK2D+1R+mKdGxjGAazIo/g2W9EmmXNeScUo5Y13Ow0UHZbxgy2p4
OzmSiPSgnfe1cqkpFemWu32G0TxjSIAWsOM9QFdIas2oMisdMgneNpfyZsj5AwOd
O+AhilZJK8jBDMXqgULFnUaBCIc+TFfXNbZbzx/wib5Sp+Ak8JYNefzAWx12akFM
KE3VyCP3Glj3xpWWBb6yLUHvObstbAMSH7WjSlYo0753h3DhUMkX2u1zi169FM5x
yvhFZ9zREljvjYzT5uQIoMqGXqhInpoI4qEkDl8d10Ye8lXUKaVR7gLqDsSwKdut
ixuN9AFCRkIrI+T+U3sgoGj99oT9t97gJqFFdj/myvx8yZMpneyvMgwgAwwI5uTt
cHEJqY59IkovhFSWx2wCelmqpQVV3y+HglX6dwSUyIfIsZsQssTtBQQYcm9QnWQ7
7sCFaHSzJNjn879MZQaJ2but/M+gwm8BrALpPuPJbbCY9Kafz6+8xzzrwSNggmul
P64nKOKhPKPsk7IZ1P7rKeqVgxhOGxv8z4igOAd6wmI9jJSSK61em11bBBMKb8oL
arpr9jmixH8OQ7Qpur54oyPFxrgePtddexgIIsCv5uWfTW0Ae70d384mgxm011Ib
iv8iTx9a1Sv2070TF7mqev4HCCi31CW3XRltorI8rs3YxdImIJN3RYjDZ4MaL4Yb
XbAAVg3YGidsx230SFH3bM9kYXINL7MiLU4hW0w3utPCLNxEDnEO6Q/J2zlqodJg
KycmzyXGkmlFFQgzYGlbFy/9vhYrRiYDLEJF7Ogx8uA69xZOcOv6ecTu9E9NW1gc
zb/cmR3lh7aFGrD/KJxPV1CllqlPjaVWM3G+WzeBrrJnHu9I3+Rwbg==
=94yf
-----END PGP MESSAGE-----

`,
            mateo: `-----BEGIN PGP MESSAGE-----
...mateo's encrypted message here...
-----END PGP MESSAGE-----`,
            alex: `-----BEGIN PGP MESSAGE-----
...alex's encrypted message here...
-----END PGP MESSAGE-----`
        };

        const hints = {
            clementine: "Hint: Luna, remember your favorite pet's name.",
            melcon: "Hint: Melcon, what stars did we see the night we met.",
            space: "Hint: What is your favorite anime?"
        };

        const recipientSelect = document.getElementById('recipient');
        const hintDiv = document.getElementById('hint');
        const output = document.getElementById('output');

        recipientSelect.addEventListener('change', () => {
            const selected = recipientSelect.value;
            if (selected && hints[selected]) {
                hintDiv.textContent = hints[selected];
            } else {
                hintDiv.textContent = "[Nothing yet]";
            }
            document.getElementById('passphrase').value = '';
            output.textContent = ''; // Clear previous output
            output.classList.remove('crt-typewriter');
        });

        function typewriterEffect(element, text, delay = 40) {
            element.textContent = '';
            element.classList.add('crt-typewriter');
            let i = 0;

            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, delay);
                }
            }
            type();
        }

        async function decrypt() {
            const selected = recipientSelect.value;
            if (!selected) {
                alert("Please select a recipient first.");
                return;
            }

            const passphrase = document.getElementById('passphrase').value;
            if (!passphrase) {
                alert("Please enter the shared secret (passphrase).");
                return;
            }

            const encryptedMessage = encryptedMessages[selected];
            if (!encryptedMessage) {
                output.textContent = "No encrypted message found for this recipient.";
                output.classList.remove('crt-typewriter');
                return;
            }

            try {
                const message = await openpgp.readMessage({ armoredMessage: encryptedMessage });
                const { data: decrypted } = await openpgp.decrypt({
                    message,
                    passwords: [passphrase],
                    format: 'utf8'
                });

                typewriterEffect(output, decrypted, 40);
                hintDiv.textContent = ''; // Remove hint on success
            } catch (err) {
                output.textContent = '‚ùå Decryption failed: ' + err.message;
                output.classList.remove('crt-typewriter');
            }
        }
    </script>

</body>

</html>